<Project>
  <!-- If a project contains a LICENSE_LOCAL this target concatenates the main LICENSE file with the project's LICENSE_LOCAL
   and outputs the concatenated string int a LICENSE file which will be included in the published NuGet package -->
  <Target Name="ConcatenateLicenseFiles" Condition="Exists('LICENSE_LOCAL')">
    <!-- List all the files to concatenate. -->
    <ItemGroup>
      <ConcatFiles Include="
        $(SolutionRoot)/LICENSE; 
        LICENSE_LOCAL" />
    </ItemGroup>

    <!-- Read the contents of the files (preserving tabs/spaces). -->
    <ItemGroup>
      <FileContents Include="$([System.IO.File]::ReadAllText(%(ConcatFiles.Identity)))" />
    </ItemGroup>

    <!-- Write the result to the LICENSE file. -->
    <WriteLinesToFile File="LICENSE" Lines="@(FileContents)" Overwrite="true" />
  </Target>

  <!-- Concatenate License files on AfterBuild. -->
  <Target Name="AfterBuild">
    <CallTarget Targets="ConcatenateLicenseFiles" />
  </Target>
</Project>